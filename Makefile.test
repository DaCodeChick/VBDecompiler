# Simple Makefile for testing PE and VB parsers without Qt
CXX = g++
CXXFLAGS = -std=c++20 -Wall -Wextra -I./src -g
LDFLAGS =

# Source files
CORE_SOURCES = src/core/pe/PEFile.cpp src/core/vb/VBFile.cpp
TEST_PE_SOURCES = src/test_pe.cpp
TEST_VB_SOURCES = src/test_vb.cpp

# Object files
CORE_OBJECTS = $(CORE_SOURCES:.cpp=.o)
TEST_PE_OBJECTS = $(TEST_PE_SOURCES:.cpp=.o)
TEST_VB_OBJECTS = $(TEST_VB_SOURCES:.cpp=.o)

# Targets
TARGET_PE = test_pe
TARGET_VB = test_vb

.PHONY: all clean test run_pe run_vb

all: $(TARGET_PE) $(TARGET_VB)

$(TARGET_PE): $(CORE_OBJECTS) $(TEST_PE_OBJECTS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(LDFLAGS)

$(TARGET_VB): $(CORE_OBJECTS) $(TEST_VB_OBJECTS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(LDFLAGS)

%.o: %.cpp
	$(CXX) $(CXXFLAGS) -c $< -o $@

clean:
	rm -f $(CORE_OBJECTS) $(TEST_PE_OBJECTS) $(TEST_VB_OBJECTS) $(TARGET_PE) $(TARGET_VB)

run_pe: $(TARGET_PE)
	./$(TARGET_PE) "/home/admin/.wine/drive_c/Program Files (x86)/Brainhouse Labs/Phalanx/Phalanx.exe"

run_vb: $(TARGET_VB)
	./$(TARGET_VB) "/home/admin/.wine/drive_c/Program Files (x86)/Brainhouse Labs/Phalanx/Phalanx.exe"

test: all run_pe run_vb
